# Как настроить интеграцию с Bazaar

Для того, чтобы работала интеграция TrackStudio и Bazaar, вам нужно установить специальное дополнение к Bazaar: [bzr-xmloutput](https://launchpad.net/bzr-xmloutput). Устанавливать его нужно на тот сервер, где установлен Bazaar, с которым будет соединяться TrackStudio.

## Для ОС GNU/Linux

1. Скачайте архив с launchpad
2. Под пользователем, от которого будет запускаться TrackStudio создайте каталог **~/.bazaar/plugins/xmloutput**
3. Разверните в него содержимое архива
4. В терминале перейдите в этот каталог и выполните команду

```
python setup.py build_ext -i
```

1. Проверьте результат, выполнив команду

```
bzr plugins
```

В ответе должен упоминаться плагин xmloutput

## Для ОС Windows

1. Скачайте архив с launchpad
2. Под пользователем, от которого будет запускаться TrackStudio создайте каталог **$APPDATA/bazaar/2.0/plugins/xmloutput** в папке этого пользователя
3. Разверните в него содержимое архива
4. В командной строке перейдите в этот каталог и выполните команду

```
python setup.py build_ext -i
```

1. Проверьте результат, выполнив команду

```
bzr plugins
```

В ответе должен упоминаться плагин xmloutput

## Настройка параметров соединения

Вы можете настроить параметры соединения с вашим хранилищем Bazaar в утилите TrackStudio Server Manager, либо, если ее нет - в любом текстовом редакторе.

### Server Manager

- Запустите приложение для управления сервером TrackStudio (SMAN)
- Перейдите в раздел SCM
- Отметьте опцию "**Включить SCM интеграцию**", если она не включена
- Укажите интервал обновления информации в минутах. Для тестирования лучше указать интервал в 1 минуту, для практического использования достаточно 10 минут.

![](../../images/scm_bazaar_1_ru.png)

- Нажмите кнопку "**Добавить**"

![](../../images/scm_bazaar_ru.png)

- В открывшемся окне укажите название соединения
- Введите номер задачи, соответствующей проекту, интеграцию для которого вы ходите включить. Интеграция будет осуществляться для всех подзадач этой задачи.
- Выберите тип SCM: Bazaar
- Укажите корень исходного кода проекта в Bazaar
- Нажмите кнопку "**Тест соединения**".
- Нажмите кнопку "**ОК**", чтобы сохранить параметры соединения.

### Настройка соединения в файлах .properties

Если у вас отсутствует возможность запустить Server Manager, вы можете настроить интеграцию с Bazaar в файле **trackstudio.scm.properties**

- Откройте файл **trackstudio.scm.properties**
- Включите интеграцию с SCM

```
trackstudio.scm.useSCM=yes
```

- Укажите время обновления информации в минутах

```
trackstudio.scm.updateInterval=10
```

Теперь можно настроить конкретное подключение.

- Для каждого из ваших проектов создайте параметр trackstudio.scm.<name>.tasknum, где tasknum — номер проекта, а <name> — название соединения. Интеграция с SCM будет осуществляться для всех подзадач указанной в этом параметре задачи.

Пример:

```
trackstudio.scm.cs.tasknum=1
```

В этом примере хранилище будет подключено к корневому проекту и интеграция будет осуществляться для всех задач в системе.

- Укажите тип SCM:

```
trackstudio.scm.cs.type=Bazaar
```

- Укажите корень исходного кода проекта в SCM:

```
trackstudio.scm.cs.root=/home/winzard/TrackStudio/sources
```

- Укажите путь до клиента bazaar:

```
trackstudio.scm.cs.native.client=/usr/bin/bzr
```

- Вы также можете указать номер ревизии, с которой начинать индексирование:

```
ttrackstudio.scm.cs.initialRevision=0
```

## Работа с TrackStudio

Чтобы ваши коммиты в Bazaar связывались с конкретными задачами TrackStudio, добавляйте в сообщения к коммитам номер (или номера) соответствующих задач в системе.

Например:

```
$ bzr commit -m "This message should be added to the task #1 and #2."
```

После того, как TrackStudio обработает информацию, при просмотре задачи будут выводиться логи коммитов в Bazaar

![](../../images/scm_trackstudio_log.png)

Вы также можете посмотреть логи коммитов ко всем задачам проекта, со ссылками на эти задачи. Для этого в TrackStudio перейдите в нужный вам проект и выберите пункт меню "**Браузер SCM**"

![](../../images/scm_browse.png)
